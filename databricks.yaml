bundle:
  name: ucapp

variables:
  sql_warehouse_id:
    description: "ID of the SQL warehouse to use"
    lookup:
      sql_warehouse: "default"
  catalog_name:
    description: "Name of the catalog to use"
    default: "app_data"
  schema_name:
    description: "Name of the schema to use"
    default: "app_ucsak"
  app_config:
    type: complex
    description: "Configuration for the Unity Catalog App"
    default:
      command:
        - "flask"
        - "run"
      env:
        - name: "DATABRICKS_WAREHOUSE_ID"
          value: ${var.sql_warehouse_id}
        - name: "DATABRICKS_CATALOG"
          value: ${var.catalog_name}
        - name: "DATABRICKS_SCHEMA"
          value: ${var.schema_name}

resources:
  apps:
    ucapp:
      name: "ucapp"
      description: "Unity Catalog App"
      source_code_path: "."
      config: ${var.app_config}
      resources:
        - name: "sql-warehouse"
          description: "SQL warehouse for the app"
          sql_warehouse:
            id: ${var.sql_warehouse_id}
            permission: "CAN_USE"
      permissions:
        - user_name: "*"
          level: "CAN_VIEW"

targets:
  dev:
    variables:
      catalog_name: "app_data_dev"
      schema_name: "app_ucsak_dev"
  
  prod:
    variables:
      catalog_name: "app_data_prod"
      schema_name: "app_ucsak_prod" 